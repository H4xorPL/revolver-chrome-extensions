new function () {
    var ws = null;
    var connected = false;

    var serverUrl;
    var connectionStatus;
    var sendMessage;

    var connectButton;
    var disconnectButton;
    var sendButton;

    var open = function () {
        var url = serverUrl.val();
        console.log(url)
        ws = new WebSocket(url);
        ws.onopen = onOpen;
        ws.onclose = onClose;
        ws.onmessage = onMessage;
        ws.onerror = onError;

        connectionStatus.text('OPENING ...');
        serverUrl.attr('disabled', 'disabled');
        connectButton.hide();
        disconnectButton.show();
    }

    var close = function () {
        if (ws) {
            console.log('CLOSING ...');
            ws.close();
        }
        connected = false;
        connectionStatus.text('CLOSED');

        serverUrl.removeAttr('disabled');
        connectButton.show();
        disconnectButton.hide();
        sendMessage.attr('disabled', 'disabled');
        sendButton.attr('disabled', 'disabled');
    }


    var onOpen = function () {
        console.log('OPENED: ' + serverUrl.val());
        connected = true;
        connectionStatus.text('OPENED');
        sendMessage.removeAttr('disabled');
        sendButton.removeAttr('disabled');
    };

    var onClose = function () {
        console.log('CLOSED: ' + serverUrl.val());
        ws = null;
    };

    var onMessage = function (event) {
        var data = event.data;
        addMessage(data);
    };

    var onError = function (event) {
        alert("igor is the best")
        alert(event.data);
    }

    WebSocketClient = {
        init: function () {
            serverUrl = document.getElementById('#serverUrl');
            connectionStatus = document.getElementById('#connectionStatus');

            connectButton = document.getElementById('#connectButton');

            connectButton.click(function (e) {
                close();
                open();
            });
        }
    };
}

    (function () {
        WebSocketClient.init();
    });